import os
import bz2
import json
import string

CUR_FOLDER = os.getcwd()
FILES = os.listdir(CUR_FOLDER)

for file in FILES:
    if file.endswith(".bz2"):
        archive = bz2.open(file)

        binary_text = archive.read()
        decoded_text = str(binary_text, "utf-8")
        archive.close()

        filename = "JsonFolder/" + file[:len(file)-4] + ".json"
        dirname = os.path.dirname(filename)
        if not os.path.exists(dirname):
            os.makedirs(dirname)
        json_file = open(filename, "w")
        json_file.write(decoded_text)
        json_file.close()


MOST_USED_WOEDS = {}
for i in os.listdir(CUR_FOLDER+"\\JsonFolder"):
    js = open("JsonFolder\\"+i, 'r').readlines()
    for dictionary in js:
        obj = json.loads(dictionary)

        body = obj["body"]
        if body == "[deleted]":
            continue
        for word in body.split():
            word = word.translate(str.maketrans('', '', string.punctuation))
            if len(word) < 3:
                continue
            if MOST_USED_WOEDS.get(word, 0):
                MOST_USED_WOEDS[word] += 1
            else:
                MOST_USED_WOEDS[word] = 1

MOST_USED_WOEDS = sorted(MOST_USED_WOEDS.items(), key=lambda x: (x[1], x[0]), reverse=True)
NUMBER = 20
for i in range(NUMBER):
    print(str(i+1)+". " + str(MOST_USED_WOEDS[i][0]))
